@model PaginatedList<ParticipantViewModel>
@{
    ViewData["Title"] = "管理參與者";
    var eventId = Context.Request.RouteValues["eventId"];
    var poolId = Context.Request.RouteValues["poolId"];
    var search = Context.Request.Query["search"];
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-responsive-tables@1.2.3/css/main.min.css"
          asp-fallback-href="~/lib/bulma-responsive-tables/css/main.min.css"
          asp-fallback-test-class="b-table"
          integrity="sha256-qqSeWOTrQzPLIhRfuz3KWtWjWqI9X60r0piSbhCdNKY=" crossorigin="anonymous">
}

<nav class="breadcrumb" aria-label="breadcrumbs">
    <ul>
        <li><a asp-area="" asp-controller="Manage" asp-action="Index">管理</a></li>
        <li><a asp-area="" asp-controller="Event" asp-action="Index">管理活動</a></li>
        <li><a asp-area="" asp-controller="Event" asp-action="Detail" asp-route-eventId="@eventId">活動詳情</a></li>
        <li><a asp-area="" asp-controller="Pool" asp-action="Index" asp-route-eventId="@eventId">管理獎池</a></li>
        <li><a asp-area="" asp-controller="Pool" asp-action="Detail" asp-route-eventId="@eventId" asp-route-poolId="@poolId">獎池詳情</a></li>
        <li class="is-active"><a asp-area="" asp-controller="Participant" asp-action="Index" asp-route-eventId="@eventId" asp-route-poolId="@poolId" aria-current="page">@ViewData["Title"]</a></li>
    </ul>
</nav>
<div class="is-flex is-justify-content-space-between">
    <h1 class="title is-3">@ViewData["Title"]</h1>
    <div class="dropdown is-right">
        <div class="dropdown-trigger">
            <button class="button is-info is-outlined" aria-haspopup="true" aria-controls="dropdown-menu">
                <span>操作</span>
                <span class="icon is-small">
                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                </span>
            </button>
        </div>
        <div class="dropdown-menu" id="dropdown-menu" role="menu">
            <div class="dropdown-content">
                <a asp-area="" asp-controller="Field" asp-action="Index" asp-route-eventId="@eventId" class="dropdown-item">管理欄位</a>
                <a asp-area="" asp-controller="Participant" asp-action="Add" asp-route-eventId="@eventId" asp-route-poolId="@poolId" class="dropdown-item">新增參與者</a>
                <a asp-area="" asp-controller="Participant" asp-action="Import" asp-route-eventId="@eventId" asp-route-poolId="@poolId" class="dropdown-item">匯入參與者</a>
                <hr class="dropdown-divider" />
                <a asp-area="" asp-controller="Activity" asp-action="Display" asp-route-eventId="@eventId" class="dropdown-item">查看活動頁面</a>
            </div>
        </div>
    </div>
</div>
<form asp-area="" asp-controller="Participant" asp-action="Index" class="field has-addons" method="get">
    <div class="control has-icons-left is-expanded">
        <input class="input" type="text" name="search" placeholder="搜尋" value="@search" />
        <span class="icon is-left">
            <i class="fas fa-search" aria-hidden="true"></i>
        </span>
    </div>
    <div class="control">
        <button type="submit" class="button is-primary">搜尋</button>
    </div>
</form>
<hr />
<div class="b-table">
    <div class="table-wrapper has-mobile-cards">
        <table class="table is-fullwidth is-striped is-fullwidth">
            <thead>
            <tr>
                <th>識別碼</th>
                @if (Model.Any())
                {
                    @foreach (var item in Model.First().Claims)
                    {
                        <th>@item.Field.Value</th>
                    }
                }
                <th></th>
            </tr>
            </thead>
            <tbody>
                @if (!Model.Any())
                {
                    <tr class="is-empty">
                        <td colspan="2">
                            <section class="section">
                                <div class="content has-text-grey has-text-centered">
                                    <figure class="image">
                                        <i class="fas fa-inbox fa-5x"></i>
                                    </figure>
                                    <p>沒有資料</p>
                                </div>
                            </section>
                        </td>
                    </tr>
                }
                else
                {
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td data-label="識別碼">@item.Id</td>
                            @for (int index = 0; index < Model.First().Claims.Count; index++)
                            {
                                <td data-label="@item.Claims.Find(x => x.Field.Id == Model.First().Claims[index].Field.Id)?.Field.Value">
                                    @item.Claims.Find(x => x.Field.Id == Model.First().Claims[index].Field.Id)?.Value
                                </td>
                            }
                            <td class="is-actions-cell">
                                <div class="buttons">
                                    <a asp-area="" asp-controller="Participant" asp-action="Detail" asp-route-eventId="@eventId" asp-route-poolId="@poolId" asp-route-participantId="@item.Id" class="button is-link is-inverted is-underlined">
                                        <span class="icon is-small">
                                            <i class="far fa-newspaper"></i>
                                        </span>
                                        <span>詳情</span>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
    @if (Model.Any())
    {
        <nav class="pagination is-centered is-rounded" role="navigation" aria-label="pagination">
            <a asp-area="" asp-controller="Participant" asp-action="Index" asp-route-eventId="@eventId" asp-route-poolId="@poolId" asp-route-page="@(Model.PageIndex-1)" disabled="@(Model.HasPreviousPage == false)" class="pagination-previous">上一頁</a>
            <a asp-area="" asp-controller="Participant" asp-action="Index" asp-route-eventId="@eventId" asp-route-poolId="@poolId" asp-route-page="@(Model.PageIndex+1)" disabled="@(Model.HasNextPage == false)" class="pagination-next">下一頁</a>
            <ul class="pagination-list">
                <li><a asp-area="" asp-controller="Participant" asp-action="Index" asp-route-eventId="@eventId" asp-route-poolId="@poolId" asp-route-page="@Model.PageIndex" class="pagination-link is-current" aria-current="page">@Model.PageIndex / @Model.TotalPages</a></li>
            </ul>
        </nav>
    }
</div>